---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
library(nextcloudr)
```

# nextcloudr

<!-- badges: start -->
<!-- badges: end -->

`nextcloudr`is a very incomplete `R` implementation of the [nextcloud WebDAV API](https://docs.nextcloud.com/server/latest/developer_manual/client_apis/WebDAV/basic.html).
I might extend it at some point, but so far it's mostly for personal usage.

## Installation

You can install the development version of nextcloudr from [GitHub](https://github.com/) with:

``` r
# install.packages("pak")
pak::pak("JBGruber/nextcloudr")
```

## Usage
### Authentication

Every time you start the package, you have to log into a nextcloud instance first:

```r
login("https://cloud.example.com")
```

```{r}
#| echo: false
cache_path <- tools::R_user_dir("nextcloudr", "cache")

token <- httr2::secret_read_rds(list.files(cache_path, full.names = TRUE)[1],
                                I(rlang::hash("supergeheim")))
login(token = token)
```

The first time you do so, you will be guided through the authentication process.

### Folders

To create a folder:

```{r}
create_folder(path = "/test/test2", recursive = TRUE)
```

To delete the folder:

``` r
delete_folder(path = "/test/test2", recursive = TRUE)
#> âœ” Folder /test/test2/ and /test/ deleted!
```

### Files

To upload files:

```{r}
void <- file.create("test.txt")
upload_files(
  source = "test.txt",
  path = "/test/test2/test.txt"
)
```

To download files:

```{r}
download_files(path = "/test/test2/test.txt")
```

To delete files:

```{r}
delete_files(path = "/test/test2/test.txt")
```


```{r cleanup}
#| include: false
#| message: false
delete_folder(path = "/test/test2", recursive = TRUE)
void <- file.remove("test.txt")
```


